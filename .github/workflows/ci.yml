name: ğŸ”¬
on:
  push:
  pull_request:
  workflow_dispatch:
jobs:
  latest:
    name: Ubuntu Latest
    runs-on: ${{ matrix.os }}
    strategy:
      matrix:
        os: [ubuntu-latest]
        node-version: ['18.x']
    if: ${{ !startsWith(github.event.head_commit.message, 'no-ci') }}
    steps:
      - name: â• Actions - Checkout
        uses: actions/checkout@v3

      - name: â• Actions - Setup NodeJS
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      - name: â• Cache Dependencies
        uses: actions/cache@v3
        with:
          path: ~/.npm
          key: npm-${{ hashFiles('package-lock.json') }}
          restore-keys: npm-

      - name: ğŸ  Create a local VPS using Docker Container
        run: docker run -d --name test-vps --privileged -p 2222:2222 -e PORT=2222 --restart always wellwelwel/vps:latest

      - name: ğŸ“¦ Installing Dependencies
        run: npm ci

      - name: âš™ï¸ Testing Services - Install
        run: npm run tests:install

      - name: ğŸ§ª Testing Services - Create
        run: npm run tests:create

      - name: ğŸ§ª Testing Services - Connection
        run: npm run tests:connection

      - name: ğŸ§ª Testing Services - Mount
        run: npm run tests:mount

      - name: âœ… Finishing
        run: npm run tests:reset >/dev/null 2>&1 || true
